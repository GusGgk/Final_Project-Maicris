<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/lista_usuarios.css">
    <title>Lista de Usuários</title>
</head>
<body>
    <div class="logo-container">
        <img src="./img/Logo_PypyCris.jpg" alt="logo">
        <div class="logo-text">Pypy.Cris</div>
    </div>
    
    <h2>Lista de Usuários da Pypy.Cris</h2>
    <div id="listaUsuarios">
        
    </div>
    <p id="mensagem"></p>
    <button>Voltar ao menu</button>
    <script>
  const token = localStorage.getItem("token");
  const userType = localStorage.getItem("user_type");

  const lista = document.getElementById("listaUsuarios");
  const mensagem = document.getElementById("mensagem");

  // Bloqueia acesso se não for admin
  if (!token || userType !== "admin") {
    alert("Acesso negado. Apenas administradores podem visualizar esta página.");
    window.location.href = "login.html";
  }

  async function carregarUsuarios() {
    try {
      const resposta = await fetch("http://localhost:5000/usuarios/", {
        method: "GET",
        headers: {
          "Authorization": `Bearer ${token}`
        }
      });

      if (!resposta.ok) {
        mensagem.textContent = "Erro ao buscar usuários.";
        return;
      }

      const usuarios = await resposta.json();

      if (usuarios.length === 0) {
        mensagem.textContent = "Nenhum usuário cadastrado.";
        return;
      }

      usuarios.forEach((usuario, index) => {
        const card = document.createElement("div");
        card.className = "usuario-card";
        card.style.setProperty('--index', index);
        card.innerHTML = `
          <strong>Nome:</strong> ${usuario.name}<br>
          <strong>Email:</strong> ${usuario.email}<br>
          <strong>Tipo:</strong> <span data-type="${usuario.user_type.toLowerCase()}">${usuario.user_type}</span><br>
          <strong>ID:</strong> ${usuario.id}
        `;
        lista.appendChild(card);
      });
    } catch (erro) {
      mensagem.textContent = "Erro ao buscar usuários.";
      console.error("Erro:", erro);
    }
  }

  document.addEventListener('DOMContentLoaded', carregarUsuarios);
</script>


</body>
</html>