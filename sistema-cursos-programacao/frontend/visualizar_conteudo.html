<!-- ======================================================
游늯 visualizar_conteudo.html
P치gina de visualiza칞칚o dos m칩dulos e aulas de um curso
========================================================= -->

<html lang="pt-br">
<head>
  <!-- ==================== METADADOS E ESTILOS ==================== -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conte칰do do Curso</title>
  <link rel="stylesheet" href="css/visualizar_conteudo.css">
</head>

<body>
  <!-- ==================== LOGO E T칈TULO ==================== -->
  <div class="logo-container">
    <img src="./img/Logo_PypyCris.jpg" alt="logo">
    <div class="logo-text">Pypy.Cris</div>
  </div>

  <h2 id="tituloCurso">Conte칰do do Curso</h2>

  <!-- ==================== CONTAINER DE M칍DULOS E MENSAGEM ==================== -->
  <div id="modulosContainer"></div>
  <p id="mensagem"></p>

  <!-- ==================== BOT츾O DE VOLTAR ==================== -->
  <button onclick="window.location.href='listar_cursos.html'">Voltar</button>

  <!-- ==================== SCRIPT DE CARREGAMENTO DO CONTE칔DO ==================== -->
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get("course_id");
    const container = document.getElementById("modulosContainer");
    const mensagem = document.getElementById("mensagem");

    // -------------------- VERIFICA SE COURSE_ID FOI FORNECIDO --------------------
    if (!courseId) {
      mensagem.textContent = "ID do curso n칚o fornecido.";
    } else {
      fetch(`http://localhost:5000/courses/${courseId}/contents`, {
        headers: {
          "Authorization": `Bearer ${localStorage.getItem("token")}`
        }
      })
      .then(res => {
        // Verifica se o aluno est치 matriculado
        if (res.status === 403) {
          mensagem.textContent = "Voc칡 n칚o est치 matriculado neste curso.";
          return null;
        }
        return res.json();
      })
      .then(data => {
        if (!data) return;

        // Verifica se h치 conte칰do
        if (data.message) {
          mensagem.textContent = data.message;
          return;
        }

        if (!data.modulos || data.modulos.length === 0) {
          mensagem.textContent = "Nenhum conte칰do cadastrado para este curso.";
          return;
        }

        // Renderiza m칩dulos e aulas
        data.modulos.forEach(modulo => {
          const moduloDiv = document.createElement("div");
          moduloDiv.className = "modulo";
          moduloDiv.innerHTML = `<h3>${modulo.titulo}</h3>`;

          modulo.aulas.forEach(aula => {
            const aulaDiv = document.createElement("div");
            aulaDiv.className = "aula";
            aulaDiv.innerHTML = `
              <p><strong>${aula.titulo}</strong> (${aula.tipo})</p>
              <a href="${aula.url_conteudo}" target="_blank">Acessar Conte칰do</a>
            `;
            moduloDiv.appendChild(aulaDiv);
          });

          container.appendChild(moduloDiv);
        });
      })
      .catch(err => {
        mensagem.textContent = "Erro ao buscar conte칰do.";
        console.error(err);
      });
    }
  </script>
</body>
</html>
