<!-- ======================================================
游늯 gerenciar_conteudo.html
P치gina central para gerenciamento de m칩dulos e aulas de um curso
========================================================= -->

<!DOCTYPE html>
<html lang="pt-br">
<head>
  <!-- ==================== METADADOS E ESTILO ==================== -->
  <meta charset="UTF-8">
  <title>Gerenciar Conte칰do</title>
  <link rel="stylesheet" href="css/gerenciar_conteudo.css">
</head>

<body>
  <!-- ==================== LOGO E CABE칂ALHO ==================== -->
  <div class="logo-container">
    <img src="./img/Logo_PypyCris.jpg" alt="logo">
    <div class="logo-text">Pypy.Cris</div>
  </div>

  <h2>Gerenciar Conte칰do do Curso</h2>

  <!-- ==================== BOT츾O PARA CRIAR M칍DULO ==================== -->
  <button onclick="navegarCriarModulo()" class="btn-criar">Criar M칩dulo</button>

  <!-- Container para listagem din칙mica de m칩dulos -->
  <div id="modulosContainer" class="modulos-container"></div>

  <!-- Mensagem de feedback -->
  <p id="mensagem"></p>

  <!-- Bot칚o de voltar -->
  <button class="btn-voltar" onclick="window.history.back()">Voltar</button>

  <!-- ==================== SCRIPT DE GERENCIAMENTO ==================== -->
  <script>
    const token = localStorage.getItem("token");
    const userType = localStorage.getItem("user_type");

    // -------------------- VERIFICA PERMISS츾O --------------------
    if (!token || (userType !== "admin" && userType !== "instrutor")) {
      alert("Acesso negado. Apenas instrutores ou administradores podem acessar esta p치gina.");
      window.location.href = "login.html";
    }

    const urlParams = new URLSearchParams(window.location.search);
    const courseId = urlParams.get("course_id");
    const container = document.getElementById("modulosContainer");
    const mensagem = document.getElementById("mensagem");

    // -------------------- NAVEGA PARA CRIA칂츾O DE M칍DULO --------------------
    function navegarCriarModulo() {
      if (!courseId) {
        alert("Curso n칚o identificado.");
        return;
      }
      window.location.href = `criar_modulo.html?course_id=${courseId}`;
    }

    // -------------------- VERIFICA SE O COURSE_ID EST츼 PRESENTE --------------------
    if (!courseId) {
      mensagem.textContent = "ID do curso n칚o fornecido.";
    } else {
      fetch(`http://localhost:5000/courses/${courseId}/contents`, {
        headers: {
          "Authorization": `Bearer ${token}`
        }
      })
      .then(res => res.json())
      .then(data => {
        if (data.message) {
          mensagem.textContent = data.message;
          return;
        }

        if (!data.modulos || data.modulos.length === 0) {
          mensagem.textContent = "Nenhum m칩dulo cadastrado.";
          return;
        }

        // -------------------- RENDERIZA M칍DULOS E LINKS --------------------
        data.modulos.forEach(modulo => {
          const moduloDiv = document.createElement("div");
          moduloDiv.className = "modulo";
          moduloDiv.innerHTML = `
            <h3>${modulo.titulo}</h3>
            <a href="criar_aula.html?course_id=${courseId}&module_id=${modulo.id}" class="btn-criar-aula">Criar Aula</a>
            <a href="editar_modulo.html?course_id=${courseId}&module_id=${modulo.id}" class="btn-editar">Editar M칩dulo</a>
            <a href="editar_aula.html?course_id=${courseId}&module_id=${modulo.id}" class="btn-editar">Editar Aulas</a>
          `;
          container.appendChild(moduloDiv);
        });
      })
      .catch(err => {
        mensagem.textContent = "Erro ao buscar conte칰do.";
        console.error(err);
      });
    }
  </script>
</body>
</html>
